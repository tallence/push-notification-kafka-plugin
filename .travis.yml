sudo: required
language: cpp
services:
- docker
env:
- DOVECOT="release-2.2.21"
before_install:
- docker network create --driver=bridge --subnet=192.168.100.0/24 --gateway=192.168.100.1 ceph_network
- travis_wait 30 docker run -itd --name build --net=ceph_network -e SOURCE_VERSION=$DOVECOT -v $(pwd):/repo cephdovecot/travis-build:$DOVECOT sh
- docker exec build sh -c 'printf "nameserver 8.8.8.8\n" > /etc/resolv.conf'
- docker exec build apt-get -qq update
- docker exec build apt-get -qq upgrade
- docker exec build sh -c 'DEBIAN_FRONTEND=noninteractive apt-get install -qq -q librdkafka-dev'
before_script:
- docker exec build sh -c 'cd /usr/local/src/dovecot; git pull origin $SOURCE_VERSION'
- docker exec build sh -c 'cd /usr/local/src/dovecot; make install'
script:
- docker exec build sh -c 'cd repo; ./autogen.sh'
- docker exec build sh -c 'cd repo; ./configure --with-dovecot=/usr/local/lib/dovecot --enable-valgrind --enable-debug --enable-maintainer-mode'
- docker exec build sh -c 'cd repo; make clean install'
- docker exec build sh -c 'ldconfig'
- docker exec build sh -c 'cd repo/src; make check'
- docker exec build sh -c 'cd /usr/local/src; wget https://www.apache.org/dyn/closer.cgi?path=/kafka/2.0.0/kafka_2.11-2.0.0.tgz'
- docker exec build sh -c 'cd /usr/local/src; tar -xzf kafka_2.11-2.0.0.tgz'
- docker exec build sh -d 'cd /usr/local/src/kafka_2.11-2.0.0;bin/zookeeper-server-start.sh config/zookeeper.properties'
- docker exec build sh -d 'cd /usr/local/src/kafka_2.11-2.0.0;bin/kafka-server-start.sh config/server.properties'
- docker exec build sh -d 'cd /usr/local/src/kafka_2.11-2.0.0;bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test'
- docker exec build sh -c 'cd /usr/local/src/kafka_2.11-2.0.0;bin/kafka-topics.sh --list --zookeeper localhost:2181'
after_script:
- docker stop build
- docker rm build
- docker network rm ceph_network

